---
title: "Group 5, R Project 3"
author: "Kera Whitley, Laura Mathews, Nataliya Peshekhodko"
date: '`r format(Sys.Date(), "%Y-%B-%d")`'

abstract: "This is abstarct."

output: pdf_document
---
```{r message=FALSE}
library(dplyr)
library (ggplot2)
library (gridExtra)
```

# First part


## 1.1. Read data
Read the data from txt file.

```{r}
data <- read.delim("mpg.txt", header=TRUE, sep=" ")
```


## 1.2. Two sample t-test

T-test with equal variance 

```{r}
equal.var.test <- t.test( MPG~Country, data = data, var.equal=TRUE, conf.level=0.95)
equal.var.test
```

Based on the equal variance t.test **p-value=`r equal.var.test$p.value`**, we can reject the null hypothesis. 

T-test with unequal variance: 

```{r}
unequal.var.test <- t.test( MPG~Country, data = data, var.equal=FALSE, conf.level = 0.95)
unequal.var.test
```

Based on the unequal variance t.test **p-value=`r unequal.var.test$p.value`**, we also can reject the null hypothesis. 

## 1.3. How well the normality assumption met by the data

Checking data normality

```{r message=FALSE}
us <- filter(data, Country == "US")
japan <- filter(data, Country == "Japan")

par(mfrow=c(2,2))
hist_us<- ggplot (us, aes(MPG))+geom_histogram(aes(y=..density..),colour="black", fill = "white") + 
  stat_function(fun=dnorm, args = list (mean = mean(us$MPG), sd=sd(us$MPG)), colour = "red")
qq_us <- ggplot(us, aes(sample = MPG))+stat_qq()+stat_qq_line()
grid.arrange(hist_us, qq_us, ncol=1, nrow=2)

hist_jpn <- ggplot (japan, aes(MPG))+geom_histogram(aes(y=..density..),colour="black", fill = "white") + 
  stat_function(fun=dnorm, args = list (mean = mean(japan$MPG), sd=sd(japan$MPG)), colour = "red")
qq_jpn <- ggplot(japan, aes(sample = MPG))+stat_qq()+stat_qq_line()
grid.arrange(hist_jpn, qq_jpn, ncol=1, nrow=2)
```


## 1.4. Preferable test for selected dataset



# Second part


```{r}
alpha = 0.05
N = 1000
n = 10 

var1 = 1
var2 = 1

mu1 = 0 
mu2 = -5

tmp_pwr <- c()
tmp_mu_diff <- c ()


yH0 <- replicate (N, rnorm (n, mean = mu1, sd = sqrt (var1) ))
cutoff <- qnorm (alpha, mean = mu1, sd = sqrt (var1) )
decisionsALPHA <- apply (X=yH0, MARGIN = 2, function (x){sum(x)<cutoff})
mean (decisionsALPHA)
yHA <- replicate (N, rnorm (n, mean = mu2, sd = sqrt (var2) ))
decisionsPWR <- apply (X = yHA, MARGIN = 2, function (x) {sum(x) < cutoff})
pwr <- mean (decisionsPWR)
#hist (colSums(yH0), prob = TRUE)
#hist (colSums(yHA), prob = TRUE)
#pwr_df <- as.data.frame(cbind (colSums(yHA)) )
tmp_pwr <- append  (tmp_pwr, pwr)
tmp_mu_diff <- append (tmp_mu_diff, mu2)

var1 = 1
var2 = 1
mu1 = 0 
mu2 = -1
yH0 <- replicate (N, rnorm (n, mean = mu1, sd = sqrt (var1) ))
cutoff <- qnorm (alpha, mean = mu1, sd = sqrt (var1) )
decisionsALPHA <- apply (X=yH0, MARGIN = 2, function (x){sum(x)<cutoff})
mean (decisionsALPHA)
yHA <- replicate (N, rnorm (n, mean = mu2, sd = sqrt (var2) ))
decisionsPWR <- apply (X = yHA, MARGIN = 2, function (x) {sum(x) < cutoff})
pwr <- mean (decisionsPWR)
tmp_pwr <- append  (tmp_pwr, pwr)
tmp_mu_diff <- append (tmp_mu_diff, mu2)



var1 = 1
var2 = 1
mu1 = 0 
mu2 = 0
yH0 <- replicate (N, rnorm (n, mean = mu1, sd = sqrt (var1) ))
cutoff <- qnorm (alpha, mean = mu1, sd = sqrt (var1) )
decisionsALPHA <- apply (X=yH0, MARGIN = 2, function (x){sum(x)<cutoff})
yHA <- replicate (N, rnorm (n, mean = mu2, sd = sqrt (var2) ))
decisionsPWR <- apply (X = yHA, MARGIN = 2, function (x) {sum(x) < cutoff})
pwr <- mean (decisionsPWR)
tmp_pwr <- append  (tmp_pwr, pwr)
tmp_mu_diff <- append (tmp_mu_diff, mu2)


var1 = 1
var2 = 1
mu1 = 0 
mu2 = 1
yH0 <- replicate (N, rnorm (n, mean = mu1, sd = sqrt (var1) ))
cutoff <- qnorm (alpha, mean = mu1, sd = sqrt (var1) )
decisionsALPHA <- apply (X=yH0, MARGIN = 2, function (x){sum(x)<cutoff})
yHA <- replicate (N, rnorm (n, mean = mu2, sd = sqrt (var2) ))
decisionsPWR <- apply (X = yHA, MARGIN = 2, function (x) {sum(x) < cutoff})
pwr <- mean (decisionsPWR)
tmp_pwr <- append  (tmp_pwr, pwr)
tmp_mu_diff <- append (tmp_mu_diff, mu2)


var1 = 1
var2 = 1

mu1 = 0 
mu2 = 5
yH0 <- replicate (N, rnorm (n, mean = mu1, sd = sqrt (var1) ))
cutoff <- qnorm (alpha, mean = mu1, sd = sqrt (var1) )
decisionsALPHA <- apply (X=yH0, MARGIN = 2, function (x){sum(x)<cutoff})
yHA <- replicate (N, rnorm (n, mean = mu2, sd = sqrt (var2) ))
decisionsPWR <- apply (X = yHA, MARGIN = 2, function (x) {sum(x) < cutoff})
pwr <- mean (decisionsPWR)
tmp_pwr <- append  (tmp_pwr, pwr)
tmp_mu_diff <- append (tmp_mu_diff, mu2)

plot(tmp_mu_diff, tmp_pwr, type = "l")
```
