---
title: "Group 5, R Project 3"
author: "Kera Whitley, Laura Mathews, Nataliya Peshekhodko"
date: '`r format(Sys.Date(), "%Y-%B-%d")`'

abstract: "This is abstarct."

output: pdf_document
---
```{r message=FALSE}
library(dplyr)
library (ggplot2)
library (gridExtra)
```

# First part


## 1.1. Read data
Read the data from txt file.

```{r}
data <- read.delim("mpg.txt", header=TRUE, sep=" ")
```


## 1.2. Two sample t-test

T-test with equal variance 

```{r}
equal.var.test <- t.test( MPG~Country, data = data, var.equal=TRUE, conf.level=0.95)
equal.var.test
```

Based on the equal variance t.test **p-value=`r equal.var.test$p.value`**, we can reject the null hypothesis. 

T-test with unequal variance: 

```{r}
unequal.var.test <- t.test( MPG~Country, data = data, var.equal=FALSE, conf.level = 0.95)
unequal.var.test
```

Based on the unequal variance t.test **p-value=`r unequal.var.test$p.value`**, we also can reject the null hypothesis. 

## 1.3. How well the normality assumption met by the data

Checking data normality

```{r message=FALSE}
us <- filter(data, Country == "US")
japan <- filter(data, Country == "Japan")

par(mfrow=c(2,2))
hist_us<- ggplot (us, aes(MPG))+geom_histogram(aes(y=..density..),colour="black", fill = "white") + 
  stat_function(fun=dnorm, args = list (mean = mean(us$MPG), sd=sd(us$MPG)), colour = "red")
qq_us <- ggplot(us, aes(sample = MPG))+stat_qq()+stat_qq_line()
grid.arrange(hist_us, qq_us, ncol=1, nrow=2)

hist_jpn <- ggplot (japan, aes(MPG))+geom_histogram(aes(y=..density..),colour="black", fill = "white") + 
  stat_function(fun=dnorm, args = list (mean = mean(japan$MPG), sd=sd(japan$MPG)), colour = "red")
qq_jpn <- ggplot(japan, aes(sample = MPG))+stat_qq()+stat_qq_line()
grid.arrange(hist_jpn, qq_jpn, ncol=1, nrow=2)
```


## 1.4. Preferable test for selected dataset

# Second part


```{r}
alpha = 0.05
N = 5000

n1 = 10
n2 = 10
mu_1 = -5
mu_2 = 0
mu1_mu2 = -5

var1 = 1
var2 = 1
#var_both = (var1/n1+var2/n2)
#yHA <-rnorm (N, mean = mu1_mu2, sd = sqrt (var_both))
#yH0 <-rnorm (N, mean = 0,  sd = sqrt (var_both))

A_sample <- as.data.frame ( replicate (N, rnorm (n1, mean = mu_1, sd = sqrt (var1))) )
B_sample <- as.data.frame ( replicate (N, rnorm (n2, mean = mu_2, sd = sqrt (var2))) )

pvalues_eq <- c()
pvalues_noteq <- c()
mu_dif <- c ()

pwr_eq_sigma1_1 <- c()
pwr_noteq_sigma1_1 <- c()

for (col in 1:ncol(A_sample)) {
  pvalues_eq <-append (pvalues_eq, t.test (A_sample[,col], B_sample[,col], var.equal=TRUE, 
                                           conf.level = 0.95)$p.value )
  pvalues_noteq <-append( pvalues_noteq, t.test (A_sample[,col], B_sample[,col], var.equal=FALSE, 
                                                 conf.level = 0.95)$p.value )}
 
pwr_eq_sigma1_1 <- append (pwr_eq_sigma1_1, sum (pvalues_eq < alpha)/N)
pwr_noteq_sigma1_1 <-append (pwr_noteq_sigma1_1,  sum (pvalues_noteq < alpha)/N )
mu_dif<-append (mu_dif, mu1_mu2)


n1 = 10
n2 = 10
mu_1 = -1
mu_2 = 0
mu1_mu2 = -1

var1 = 1
var2 = 1
var_both = (var1/n1+var2/n2)

A_sample <- as.data.frame ( replicate (N, rnorm (n1, mean = mu_1, sd = sqrt (var1))) )
B_sample <- as.data.frame ( replicate (N, rnorm (n2, mean = mu_2, sd = sqrt (var2))) )


pvalues_eq <- c()
pvalues_noteq <- c()

for (col in 1:ncol(A_sample)) {
  
  pvalues_eq <-append (pvalues_eq, t.test (A_sample[,col], B_sample[,col], var.equal=TRUE, 
                                           conf.level = 0.95)$p.value )
  pvalues_noteq <-append( pvalues_noteq, t.test (A_sample[,col], B_sample[,col], var.equal=FALSE, 
                                                 conf.level = 0.95)$p.value )
}
 
pwr_eq_sigma1_1 <- append (pwr_eq_sigma1_1, sum (pvalues_eq < alpha)/N)
pwr_noteq_sigma1_1 <-append (pwr_noteq_sigma1_1,  sum (pvalues_noteq < alpha)/N )
mu_dif<-append (mu_dif, mu1_mu2)


n1 = 10
n2 = 10
mu_1 = 1
mu_2 = 0
mu1_mu2 = 1

var1 = 1
var2 = 1
var_both = (var1/n1+var2/n2)

A_sample <- as.data.frame ( replicate (N, rnorm (n1, mean = mu_1, sd = sqrt (var1))) )
B_sample <- as.data.frame ( replicate (N, rnorm (n2, mean = mu_2, sd = sqrt (var2))) )


pvalues_eq <- c()
pvalues_noteq <- c()

for (col in 1:ncol(A_sample)) {
  
  pvalues_eq <-append (pvalues_eq, t.test (A_sample[,col], B_sample[,col], var.equal=TRUE, 
                                           conf.level = 0.95)$p.value )
  pvalues_noteq <-append( pvalues_noteq, t.test (A_sample[,col], B_sample[,col], var.equal=FALSE, 
                                                 conf.level = 0.95)$p.value )
}
 
pwr_eq_sigma1_1 <- append (pwr_eq_sigma1_1, sum (pvalues_eq < alpha)/N)
pwr_noteq_sigma1_1 <-append (pwr_noteq_sigma1_1,  sum (pvalues_noteq < alpha)/N )
mu_dif<-append (mu_dif, mu1_mu2)

n1 = 10
n2 = 10
mu_1 = 5
mu_2 = 0
mu1_mu2 = 5

var1 = 1
var2 = 1
var_both = (var1/n1+var2/n2)

A_sample <- as.data.frame ( replicate (N, rnorm (n1, mean = mu_1, sd = sqrt (var1))) )
B_sample <- as.data.frame ( replicate (N, rnorm (n2, mean = mu_2, sd = sqrt (var2))) )


pvalues_eq <- c()
pvalues_noteq <- c()

for (col in 1:ncol(A_sample)) {
  
  pvalues_eq <-append (pvalues_eq, t.test (A_sample[,col], B_sample[,col], var.equal=TRUE, 
                                           conf.level = 0.95)$p.value )
  pvalues_noteq <-append( pvalues_noteq, t.test (A_sample[,col], B_sample[,col], var.equal=FALSE, 
                                                 conf.level = 0.95)$p.value )
}
 
pwr_eq_sigma1_1 <- append (pwr_eq_sigma1_1, sum (pvalues_eq < alpha)/N)
pwr_noteq_sigma1_1 <-append (pwr_noteq_sigma1_1,  sum (pvalues_noteq < alpha)/N )
mu_dif<-append (mu_dif, mu1_mu2)

#plot (mu_dif, pwr_eq_sigma1_1, type="l")
#plot (mu_dif, pwr_noteq_sigma1_1, type="l")

n1 = 10
n2 = 10
mu_1 = -5
mu_2 = 0
mu1_mu2 = -5

var1 = 3
var2 = 1
var_both = (var1/n1+var2/n2)

#yHA <-rnorm (N, mean = mu1_mu2, sd = sqrt (var_both))
#yH0 <-rnorm (N, mean = 0,  sd = sqrt (var_both))

A_sample <- as.data.frame ( replicate (N, rnorm (n1, mean = mu_1, sd = sqrt (var1))) )
B_sample <- as.data.frame ( replicate (N, rnorm (n2, mean = mu_2, sd = sqrt (var2))) )

pvalues_eq <- c()
pvalues_noteq <- c()
mu_dif <- c ()

pwr_eq_sigma1_3 <- c()
pwr_noteq_sigma1_3 <- c()

for (col in 1:ncol(A_sample)) {
  
  pvalues_eq <-append (pvalues_eq, t.test (A_sample[,col], B_sample[,col], var.equal=TRUE, 
                                           conf.level = 0.95)$p.value )
  pvalues_noteq <-append( pvalues_noteq, t.test (A_sample[,col], B_sample[,col], var.equal=FALSE, 
                                                 conf.level = 0.95)$p.value )
}
 
pwr_eq_sigma1_3 <- append (pwr_eq_sigma1_3, sum (pvalues_eq < alpha)/N)
pwr_noteq_sigma1_3 <-append (pwr_noteq_sigma1_3,  sum (pvalues_noteq < alpha)/N )
mu_dif<-append (mu_dif, mu1_mu2)


n1 = 10
n2 = 10
mu_1 = -1
mu_2 = 0
mu1_mu2 = -1

var1 = 3
var2 = 1
var_both = (var1/n1+var2/n2)

A_sample <- as.data.frame ( replicate (N, rnorm (n1, mean = mu_1, sd = sqrt (var1))) )
B_sample <- as.data.frame ( replicate (N, rnorm (n2, mean = mu_2, sd = sqrt (var2))) )


pvalues_eq <- c()
pvalues_noteq <- c()

for (col in 1:ncol(A_sample)) {
  
  pvalues_eq <-append (pvalues_eq, t.test (A_sample[,col], B_sample[,col], var.equal=TRUE, 
                                           conf.level = 0.95)$p.value )
  pvalues_noteq <-append( pvalues_noteq, t.test (A_sample[,col], B_sample[,col], var.equal=FALSE, 
                                                 conf.level = 0.95)$p.value )
}
 
pwr_eq_sigma1_3 <- append (pwr_eq_sigma1_3, sum (pvalues_eq < alpha)/N)
pwr_noteq_sigma1_3 <-append (pwr_noteq_sigma1_3,  sum (pvalues_noteq < alpha)/N )
mu_dif<-append (mu_dif, mu1_mu2)


n1 = 10
n2 = 10
mu_1 = 1
mu_2 = 0
mu1_mu2 = 1

var1 = 3
var2 = 1
var_both = (var1/n1+var2/n2)

A_sample <- as.data.frame ( replicate (N, rnorm (n1, mean = mu_1, sd = sqrt (var1))) )
B_sample <- as.data.frame ( replicate (N, rnorm (n2, mean = mu_2, sd = sqrt (var2))) )


pvalues_eq <- c()
pvalues_noteq <- c()

for (col in 1:ncol(A_sample)) {
  
  pvalues_eq <-append (pvalues_eq, t.test (A_sample[,col], B_sample[,col], var.equal=TRUE, 
                                           conf.level = 0.95)$p.value )
  pvalues_noteq <-append( pvalues_noteq, t.test (A_sample[,col], B_sample[,col], var.equal=FALSE, 
                                                 conf.level = 0.95)$p.value )
}
 
pwr_eq_sigma1_3 <- append (pwr_eq_sigma1_3, sum (pvalues_eq < alpha)/N)
pwr_noteq_sigma1_3 <-append (pwr_noteq_sigma1_3,  sum (pvalues_noteq < alpha)/N )
mu_dif<-append (mu_dif, mu1_mu2)

n1 = 10
n2 = 10
mu_1 = 5
mu_2 = 0
mu1_mu2 = 5

var1 = 3
var2 = 1
var_both = (var1/n1+var2/n2)

A_sample <- as.data.frame ( replicate (N, rnorm (n1, mean = mu_1, sd = sqrt (var1))) )
B_sample <- as.data.frame ( replicate (N, rnorm (n2, mean = mu_2, sd = sqrt (var2))) )


pvalues_eq <- c()
pvalues_noteq <- c()

for (col in 1:ncol(A_sample)) {
  
  pvalues_eq <-append (pvalues_eq, t.test (A_sample[,col], B_sample[,col], var.equal=TRUE, 
                                           conf.level = 0.95)$p.value )
  pvalues_noteq <-append( pvalues_noteq, t.test (A_sample[,col], B_sample[,col], var.equal=FALSE, 
                                                 conf.level = 0.95)$p.value )
}
 
pwr_eq_sigma1_3 <- append (pwr_eq_sigma1_3, sum (pvalues_eq < alpha)/N)
pwr_noteq_sigma1_3 <-append (pwr_noteq_sigma1_3,  sum (pvalues_noteq < alpha)/N )
mu_dif<-append (mu_dif, mu1_mu2)

#plot (mu_dif, pwr_eq_sigma1_3, type="l")
#plot (mu_dif, pwr_noteq_sigma1_3, type="l")


n1 = 10
n2 = 10
mu_1 = -5
mu_2 = 0
mu1_mu2 = -5

var1 = 9
var2 = 1
var_both = (var1/n1+var2/n2)

#yHA <-rnorm (N, mean = mu1_mu2, sd = sqrt (var_both))
#yH0 <-rnorm (N, mean = 0,  sd = sqrt (var_both))

A_sample <- as.data.frame ( replicate (N, rnorm (n1, mean = mu_1, sd = sqrt (var1))) )
B_sample <- as.data.frame ( replicate (N, rnorm (n2, mean = mu_2, sd = sqrt (var2))) )

pvalues_eq <- c()
pvalues_noteq <- c()
mu_dif <- c ()

pwr_eq_sigma1_9 <- c()
pwr_noteq_sigma1_9 <- c()

for (col in 1:ncol(A_sample)) {
  
  pvalues_eq <-append (pvalues_eq, t.test (A_sample[,col], B_sample[,col], var.equal=TRUE, 
                                           conf.level = 0.95)$p.value )
  pvalues_noteq <-append( pvalues_noteq, t.test (A_sample[,col], B_sample[,col], var.equal=FALSE, 
                                                 conf.level = 0.95)$p.value )
}
 
pwr_eq_sigma1_9 <- append (pwr_eq_sigma1_9, sum (pvalues_eq < alpha)/N)
pwr_noteq_sigma1_9 <-append (pwr_noteq_sigma1_9,  sum (pvalues_noteq < alpha)/N )
mu_dif<-append (mu_dif, mu1_mu2)


n1 = 10
n2 = 10
mu_1 = -1
mu_2 = 0
mu1_mu2 = -1

var1 = 9
var2 = 1
var_both = (var1/n1+var2/n2)

A_sample <- as.data.frame ( replicate (N, rnorm (n1, mean = mu_1, sd = sqrt (var1))) )
B_sample <- as.data.frame ( replicate (N, rnorm (n2, mean = mu_2, sd = sqrt (var2))) )


pvalues_eq <- c()
pvalues_noteq <- c()

for (col in 1:ncol(A_sample)) {
  
  pvalues_eq <-append (pvalues_eq, t.test (A_sample[,col], B_sample[,col], var.equal=TRUE, 
                                           conf.level = 0.95)$p.value )
  pvalues_noteq <-append( pvalues_noteq, t.test (A_sample[,col], B_sample[,col], var.equal=FALSE, 
                                                 conf.level = 0.95)$p.value )
}
 
pwr_eq_sigma1_9 <- append (pwr_eq_sigma1_9, sum (pvalues_eq < alpha)/N)
pwr_noteq_sigma1_9 <-append (pwr_noteq_sigma1_9,  sum (pvalues_noteq < alpha)/N )
mu_dif<-append (mu_dif, mu1_mu2)


n1 = 10
n2 = 10
mu_1 = 1
mu_2 = 0
mu1_mu2 = 1

var1 = 9
var2 = 1
var_both = (var1/n1+var2/n2)

A_sample <- as.data.frame ( replicate (N, rnorm (n1, mean = mu_1, sd = sqrt (var1))) )
B_sample <- as.data.frame ( replicate (N, rnorm (n2, mean = mu_2, sd = sqrt (var2))) )


pvalues_eq <- c()
pvalues_noteq <- c()

for (col in 1:ncol(A_sample)) {
  
  pvalues_eq <-append (pvalues_eq, t.test (A_sample[,col], B_sample[,col], var.equal=TRUE, 
                                           conf.level = 0.95)$p.value )
  pvalues_noteq <-append( pvalues_noteq, t.test (A_sample[,col], B_sample[,col], var.equal=FALSE, 
                                                 conf.level = 0.95)$p.value )
}
 
pwr_eq_sigma1_9 <- append (pwr_eq_sigma1_9, sum (pvalues_eq < alpha)/N)
pwr_noteq_sigma1_9 <-append (pwr_noteq_sigma1_9,  sum (pvalues_noteq < alpha)/N )
mu_dif<-append (mu_dif, mu1_mu2)

n1 = 10
n2 = 10
mu_1 = 5
mu_2 = 0
mu1_mu2 = 5

var1 = 9
var2 = 1
var_both = (var1/n1+var2/n2)

A_sample <- as.data.frame ( replicate (N, rnorm (n1, mean = mu_1, sd = sqrt (var1))) )
B_sample <- as.data.frame ( replicate (N, rnorm (n2, mean = mu_2, sd = sqrt (var2))) )


pvalues_eq <- c()
pvalues_noteq <- c()

for (col in 1:ncol(A_sample)) {
  
  pvalues_eq <-append (pvalues_eq, t.test (A_sample[,col], B_sample[,col], var.equal=TRUE, 
                                           conf.level = 0.95)$p.value )
  pvalues_noteq <-append( pvalues_noteq, t.test (A_sample[,col], B_sample[,col], var.equal=FALSE, 
                                                 conf.level = 0.95)$p.value )
}
 
pwr_eq_sigma1_9 <- append (pwr_eq_sigma1_9, sum (pvalues_eq < alpha)/N)
pwr_noteq_sigma1_9 <-append (pwr_noteq_sigma1_9,  sum (pvalues_noteq < alpha)/N )
mu_dif<-append (mu_dif, mu1_mu2)

#plot (mu_dif, pwr_eq_sigma1_9, type="l")
#plot (mu_dif, pwr_noteq_sigma1_9, type="l")

res <- as.data.frame(cbind (mu_dif, pwr_eq_sigma1_1, pwr_noteq_sigma1_1, pwr_eq_sigma1_3, pwr_noteq_sigma1_3,
                            pwr_eq_sigma1_9, pwr_noteq_sigma1_9))


ggplot ()+ geom_line (data = res, aes (x = mu_dif, pwr_eq_sigma1_1), color = "blue") + 
           geom_line (data = res, aes (x = mu_dif, pwr_noteq_sigma1_1), color = "red") +
           geom_line (data = res, aes (x = mu_dif, pwr_eq_sigma1_3), color = "green") + 
           geom_line (data = res, aes (x = mu_dif, pwr_noteq_sigma1_3), color = "black")+
           geom_line (data = res, aes (x = mu_dif, pwr_eq_sigma1_9), color = "grey") +
           geom_line (data = res, aes (x = mu_dif, pwr_noteq_sigma1_9), color = "brown")
  

  

```

